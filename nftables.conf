#!/usr/sbin/nft -f

# Generated by nftables_converter.py
# Generated on 2025-04-06 18:44:17

flush ruleset

table inet filter {
    set ipsum {
        type ipv4_addr
    }

    chain input {
        type filter hook input priority 0; policy drop;
        ip saddr @ipsum drop comment "Blacklisted IPs"
        tcp dport 22 tcp flags & (syn) == syn meter syn_per_ip { ip saddr limit rate over 10/minute } reject with tcp reset
        tcp flags & (syn|fin) == (syn|fin) drop
        tcp flags & (syn|rst) == (syn|rst) drop
        tcp flags == 0x0 drop
        tcp flags & (fin|syn|rst|ack|urg) == (fin|syn|rst|ack|urg) drop
        tcp flags & (fin|rst) == (fin|rst) drop
        tcp flags & (ack|fin) == fin drop
        tcp flags & (ack|psh) == psh drop
        tcp flags & (ack|urg) == urg drop
        ct state established,related accept
        iif lo accept comment "Allow connections on local interface: lo"
        iif ens33 tcp dport { 22 } ct state new,established accept
        iif ens33 tcp sport { 22 } ct state established accept
        iif ens33 udp sport 53 accept
        icmp type echo-request drop
        log prefix "[NFTABLES] INPUT: " flags all
        tcp dport 22 jump f2b-sshd
    }

    chain forward {
        type filter hook forward priority 0; policy accept;
        log prefix "[NFTABLES] FORWARD: " flags all
    }

    chain output {
        type filter hook output priority 0; policy accept;
        oif ens33 tcp sport { 22 } ct state established accept
        oif ens33 tcp dport { 22 } ct state new,established accept
        oif ens33 udp dport 53 accept
        icmp type echo-reply drop
    }

    chain f2b-sshd {
    }

}

table inet nat {
    chain prerouting {
        type nat hook prerouting priority -100;
    }

    chain postrouting {
        type nat hook postrouting priority 100;
    }

}

table inet mangle {
    chain prerouting {
        type filter hook prerouting priority -150;
        ct state invalid drop
        tcp flags syn tcp option maxseg size 1-535 drop
        ip saddr 224.0.0.0/3 drop
        ip saddr 0.0.0.0/8 drop
        ip saddr 240.0.0.0/5 drop
        iif != lo ip saddr 127.0.0.0/8 drop
        tcp flags & (fin|syn|rst|psh|ack|urg) == 0x0 drop
        tcp flags & (fin|syn) == (fin|syn) drop
        tcp flags & (syn|rst) == (syn|rst) drop
        tcp flags & (fin|rst) == (fin|rst) drop
        tcp flags & (fin|ack) == fin drop
        tcp flags & (ack|urg) == urg drop
        tcp flags & (ack|fin) == fin drop
        tcp flags & (ack|psh) == psh drop
        tcp flags == (fin|syn|rst|psh|ack|urg) drop
        tcp flags == 0x0 drop
        tcp flags & (fin|psh|urg) == (fin|psh|urg) drop
        tcp flags & (fin|syn|psh|urg) == (fin|syn|psh|urg) drop
        tcp flags & (fin|syn|rst|ack|urg) == (fin|syn|rst|ack|urg) drop
    }

}

